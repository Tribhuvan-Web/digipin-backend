# ğŸ—ï¸ DigiPin - System Architecture Documentation

## ğŸ“‹ Table of Contents
- [System Overview](#system-overview)
- [Architecture Diagram](#architecture-diagram)
- [Component Architecture](#component-architecture)
- [Data Flow Diagrams](#data-flow-diagrams)
- [Database Schema](#database-schema)
- [Security Architecture](#security-architecture)
- [API Architecture](#api-architecture)

---

## ğŸŒ System Overview

DigiPin is a comprehensive digital address resolution system with consent-based access control, built on a secure, scalable, and tamper-proof architecture. The system integrates multiple verification mechanisms, real-time confidence scoring, and cryptographically verifiable audit trails.

### Key Architectural Principles
- **Layered Architecture**: Clear separation of concerns (Controller â†’ Service â†’ Repository)
- **Security-First Design**: JWT authentication, BCrypt encryption, Spring Security
- **Tamper-Proof Auditing**: ImmuDB integration for cryptographic verification
- **Scalable Design**: Stateless REST APIs, horizontal scaling support
- **Microservice-Ready**: Modular design with clear service boundaries

---

## ğŸ¨ Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CLIENT APPLICATIONS                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Web App    â”‚  â”‚ Mobile App  â”‚  â”‚ AIU Systems â”‚  â”‚ AAVA Portal â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                 â”‚                 â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   API GATEWAY       â”‚
                         â”‚  (Port 8080)        â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                           â”‚                           â”‚
        â”‚        JWT AUTHENTICATION FILTER                      â”‚
        â”‚              (Spring Security)                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   DIGIPIN APPLICATION                          â”‚
    â”‚                    (Spring Boot 3.5.8)                         â”‚
    â”‚                                                                â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚              CONTROLLER LAYER (REST APIs)                â”‚ â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
    â”‚  â”‚  â”‚  Auth    â”‚  â”‚ Digital  â”‚  â”‚  AAVA    â”‚  â”‚  AIU    â”‚ â”‚ â”‚
    â”‚  â”‚  â”‚Controllerâ”‚  â”‚ Address  â”‚  â”‚Controllerâ”‚  â”‚Controllerâ”‚ â”‚ â”‚
    â”‚  â”‚  â”‚          â”‚  â”‚Controllerâ”‚  â”‚          â”‚  â”‚         â”‚ â”‚ â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚ â”‚
    â”‚  â”‚       â”‚             â”‚             â”‚             â”‚       â”‚ â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                             â”‚ â”‚
    â”‚  â”‚  â”‚  Audit   â”‚  â”‚  QR Code â”‚                             â”‚ â”‚
    â”‚  â”‚  â”‚Controllerâ”‚  â”‚Generator â”‚                             â”‚ â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                             â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚          â”‚              â”‚                                     â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚              SERVICE LAYER (Business Logic)             â”‚ â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
    â”‚  â”‚  â”‚  Auth    â”‚  â”‚ Digital  â”‚  â”‚ Consent  â”‚  â”‚ ImmuDB  â”‚â”‚ â”‚
    â”‚  â”‚  â”‚ Service  â”‚  â”‚ Address  â”‚  â”‚ Service  â”‚  â”‚ Service â”‚â”‚ â”‚
    â”‚  â”‚  â”‚          â”‚  â”‚ Service  â”‚  â”‚          â”‚  â”‚         â”‚â”‚ â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â”‚ â”‚
    â”‚  â”‚       â”‚             â”‚             â”‚             â”‚      â”‚ â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”â”‚ â”‚
    â”‚  â”‚  â”‚       Custom User Details Service                  â”‚â”‚ â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”˜â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”˜ â”‚
    â”‚                                   â”‚                     â”‚   â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â” â”‚
    â”‚  â”‚           REPOSITORY LAYER (Data Access)               â”‚ â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
    â”‚  â”‚  â”‚   User   â”‚  â”‚ Digital  â”‚  â”‚ Consent  â”‚  â”‚Aadhaar â”‚â”‚ â”‚
    â”‚  â”‚  â”‚   Repo   â”‚  â”‚ Address  â”‚  â”‚   Repo   â”‚  â”‚  Mock  â”‚â”‚ â”‚
    â”‚  â”‚  â”‚          â”‚  â”‚   Repo   â”‚  â”‚          â”‚  â”‚  Repo  â”‚â”‚ â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â”‚ â”‚
    â”‚  â”‚       â”‚             â”‚             â”‚            â”‚      â”‚ â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”â”‚ â”‚
    â”‚  â”‚  â”‚        User Address Repository                    â”‚â”‚ â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                                   â”‚                        â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚              UTILITY COMPONENTS                        â”‚ â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
    â”‚  â”‚  â”‚   JWT    â”‚  â”‚ DigiPin  â”‚  â”‚    Rate Limiter      â”‚â”‚ â”‚
    â”‚  â”‚  â”‚   Util   â”‚  â”‚Algorithm â”‚  â”‚    (Bucket4j)        â”‚â”‚ â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                               â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                                   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚  MySQL   â”‚                                   â”‚ ImmuDB   â”‚
    â”‚ Database â”‚                                   â”‚ Database â”‚
    â”‚          â”‚                                   â”‚          â”‚
    â”‚ â€¢ Users  â”‚                                   â”‚ â€¢ Audit  â”‚
    â”‚ â€¢ Addressâ”‚                                   â”‚   Logs   â”‚
    â”‚ â€¢ Consentâ”‚                                   â”‚ â€¢ Crypto â”‚
    â”‚ â€¢ Aadhaarâ”‚                                   â”‚   Verify â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© Component Architecture

### 1. **Presentation Layer (Controllers)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     REST CONTROLLERS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  AuthController (/api/auth)                                 â”‚
â”‚  â”œâ”€â”€ POST   /register         â†’ User Registration           â”‚
â”‚  â”œâ”€â”€ POST   /login            â†’ Authentication              â”‚
â”‚  â”œâ”€â”€ POST   /verify-aadhaar   â†’ KYC Verification            â”‚
â”‚  â””â”€â”€ GET    /profile          â†’ User Profile                â”‚
â”‚                                                             â”‚
â”‚  DigitalAddressController (/api/digital-address)            â”‚
â”‚  â”œâ”€â”€ POST   /create           â†’ Create Address              â”‚
â”‚  â”œâ”€â”€ GET    /{address}        â†’ Get Address Details         â”‚
â”‚  â”œâ”€â”€ GET    /                 â†’ List All Addresses          â”‚
â”‚  â”œâ”€â”€ GET    /digipin          â†’ Generate DigiPin            â”‚
â”‚  â”œâ”€â”€ PUT    /update           â†’ Update Address              â”‚
â”‚  â”œâ”€â”€ DELETE /delete           â†’ Delete Address              â”‚
â”‚  â””â”€â”€ POST   /flag-for-aava    â†’ Flag for Verification       â”‚
â”‚                                                             â”‚
â”‚  AAVAController (/api/aava)                                 â”‚
â”‚  â”œâ”€â”€ POST   /aava-verify      â†’ Submit Verification         â”‚
â”‚  â””â”€â”€ GET    /aava-status/{id} â†’ Get Verification Status     â”‚
â”‚                                                             â”‚
â”‚  AIUController (/api/aiu)                                   â”‚
â”‚  â”œâ”€â”€ POST   /store            â†’ Store User Address          â”‚
â”‚  â”œâ”€â”€ POST   /resolve-with-consent â†’ Resolve Address         â”‚
â”‚  â””â”€â”€ POST   /feedback         â†’ Submit Fulfillment Feedback â”‚
â”‚                                                             â”‚
â”‚  AuditController (/api/audit)                               â”‚
â”‚  â”œâ”€â”€ GET    /audit-history/{address} â†’ Get Audit Logs       â”‚
â”‚  â”œâ”€â”€ POST   /verify-audit    â†’ Verify Data Integrity        â”‚
â”‚  â”œâ”€â”€ GET    /audit-stats      â†’ Audit Statistics            â”‚
â”‚  â””â”€â”€ GET    /confidence-score/{id} â†’ Get Trust Score        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. **Business Logic Layer (Services)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SERVICE LAYER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  AuthService                                                â”‚
â”‚  â”œâ”€â”€ User Registration & Authentication                     â”‚
â”‚  â”œâ”€â”€ Aadhaar Verification (Mock Integration)                â”‚
â”‚  â”œâ”€â”€ JWT Token Management                                   â”‚
â”‚  â””â”€â”€ User Profile Management                                â”‚
â”‚                                                             â”‚
â”‚  DigitalAddressService                                      â”‚
â”‚  â”œâ”€â”€ Digital Address CRUD Operations                        â”‚
â”‚  â”œâ”€â”€ DigiPin Generation (Grid-Based Algorithm)              â”‚
â”‚  â”œâ”€â”€ Address Validation & Management                        â”‚
â”‚  â”œâ”€â”€ AAVA Verification Processing                           â”‚
â”‚  â”œâ”€â”€ Confidence Score Updates                               â”‚
â”‚  â””â”€â”€ Address Ownership Verification                         â”‚
â”‚                                                             â”‚
â”‚  ConsentService                                             â”‚
â”‚  â”œâ”€â”€ Consent Creation & Management                          â”‚
â”‚  â”œâ”€â”€ DA  PIN Verification (BCrypt)                          â”‚
â”‚  â”œâ”€â”€ Consent Token Generation                               â”‚
â”‚  â”œâ”€â”€ Expiry Management (PERMANENT/TEMPORARY)                â”‚
â”‚  â””â”€â”€ Active Consent Retrieval                               â”‚
â”‚                                                             â”‚
â”‚  ImmuDBService                                              â”‚
â”‚  â”œâ”€â”€ Address Creation Audit Logging                         â”‚
â”‚  â”œâ”€â”€ Address Resolution Logging                             â”‚
â”‚  â”œâ”€â”€ AAVA Verification Logging                              â”‚
â”‚  â”œâ”€â”€ Confidence Score Update Logging                        â”‚
â”‚  â”œâ”€â”€ Audit History Retrieval                                â”‚
â”‚  â”œâ”€â”€ Cryptographic Verification                             â”‚
â”‚  â””â”€â”€ Tamper Detection                                       â”‚
â”‚                                                             â”‚
â”‚  CustomUserDetailsService                                   â”‚
â”‚  â”œâ”€â”€ Spring Security Integration                            â”‚
â”‚  â”œâ”€â”€ User Authentication Support                            â”‚
â”‚  â””â”€â”€ UserDetails Loading                                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. **Data Access Layer (Repositories)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               REPOSITORY LAYER (JPA)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  UserRepository                                              â”‚
â”‚  â”œâ”€â”€ findByUserName(String) â†’ Optional<User>                â”‚
â”‚  â”œâ”€â”€ findByEmailId(String) â†’ Optional<User>                 â”‚
â”‚  â”œâ”€â”€ findByPhoneNumber(String) â†’ Optional<User>             â”‚
â”‚  â””â”€â”€ existsByAadhaarNumber(String) â†’ boolean                â”‚
â”‚                                                              â”‚
â”‚  DigitalAddressRepository                                    â”‚
â”‚  â”œâ”€â”€ findByUserId(Long) â†’ List<DigitalAddress>              â”‚
â”‚  â”œâ”€â”€ findByDigitalAddress(String) â†’ Optional<Address>       â”‚
â”‚  â”œâ”€â”€ findByGeneratedDigipin(String) â†’ Optional<Address>     â”‚
â”‚  â””â”€â”€ findByRequiresAavaVerification(boolean) â†’ List<...>    â”‚
â”‚                                                              â”‚
â”‚  ConsentRepository                                           â”‚
â”‚  â”œâ”€â”€ findByDigitalAddressId(Long) â†’ List<Consent>           â”‚
â”‚  â”œâ”€â”€ findActiveConsentByAddressId(Long) â†’ Optional<Consent> â”‚
â”‚  â””â”€â”€ findExpiredConsents() â†’ List<Consent>                  â”‚
â”‚                                                              â”‚
â”‚  AadhaarMockDataRepository                                   â”‚
â”‚  â”œâ”€â”€ findByAadhaarNumber(String) â†’ Optional<AadhaarData>    â”‚
â”‚  â””â”€â”€ findByAadhaarNumberAndDob(...) â†’ Optional<...>         â”‚
â”‚                                                              â”‚
â”‚  UserAddressRepository                                       â”‚
â”‚  â””â”€â”€ Standard CRUD operations                               â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow Diagrams

### Flow 1: User Registration & Address Creation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚         â”‚   DigiPin    â”‚         â”‚   MySQL     â”‚
â”‚ Client  â”‚         â”‚  Application â”‚         â”‚  Database   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚                        â”‚
     â”‚  1. POST /register  â”‚                        â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
     â”‚                     â”‚  2. Validate Data      â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
     â”‚                     â”‚           â”‚            â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
     â”‚                     â”‚                        â”‚
     â”‚                     â”‚  3. Hash Password      â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
     â”‚                     â”‚           â”‚            â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
     â”‚                     â”‚                        â”‚
     â”‚                     â”‚  4. Save User          â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                     â”‚                        â”‚
     â”‚                     â”‚  5. User Saved         â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                     â”‚                        â”‚
     â”‚  6. Success (201)   â”‚                        â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
     â”‚                     â”‚                        â”‚
     â”‚  7. POST /login     â”‚                        â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
     â”‚                     â”‚  8. Authenticate       â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                     â”‚                        â”‚
     â”‚                     â”‚  9. Generate JWT       â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
     â”‚                     â”‚           â”‚            â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
     â”‚                     â”‚                        â”‚
     â”‚  10. JWT Token      â”‚                        â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
     â”‚                     â”‚                        â”‚
     â”‚  11. POST /verify-  â”‚                        â”‚
     â”‚      aadhaar        â”‚                        â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
     â”‚  (JWT + Aadhaar)    â”‚                        â”‚
     â”‚                     â”‚  12. Verify Aadhaar    â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                     â”‚      (Mock Data)       â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                     â”‚                        â”‚
     â”‚                     â”‚  13. Update User       â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                     â”‚                        â”‚
     â”‚  14. Verified (200) â”‚                        â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
     â”‚                     â”‚                        â”‚
     â”‚  15. POST /create   â”‚                        â”‚
     â”‚   (Digital Address) â”‚                        â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
     â”‚                     â”‚                        â”‚
     â”‚                     â”‚  16. Generate DigiPin  â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
     â”‚                     â”‚  (lat/lon)â”‚            â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
     â”‚                     â”‚                        â”‚
     â”‚                     â”‚  17. Hash UPI PIN      â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
     â”‚                     â”‚           â”‚            â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
     â”‚                     â”‚                        â”‚
     â”‚                     â”‚  18. Save Address      â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                     â”‚      & Consent         â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                     â”‚                        â”‚
     â”‚                     â”‚  19. Log to ImmuDB     â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
     â”‚                     â”‚  (Audit)  â”‚            â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
     â”‚                     â”‚                        â”‚
     â”‚  20. Created (201)  â”‚                        â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
     â”‚                     â”‚                        â”‚
```

### Flow 2: AIU Address Resolution with Consent

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AIU    â”‚         â”‚   DigiPin    â”‚         â”‚   MySQL     â”‚         â”‚ ImmuDB   â”‚
â”‚ System  â”‚         â”‚  Application â”‚         â”‚  Database   â”‚         â”‚ Database â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚  1. POST /resolve-  â”‚                        â”‚                     â”‚
     â”‚     with-consent    â”‚                        â”‚                     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚                     â”‚
     â”‚  (address + UPI PIN)â”‚                        â”‚                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚                     â”‚  2. Find Address       â”‚                     â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚                     â”‚  3. Verify UPI PIN     â”‚                     â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚                     â”‚
     â”‚                     â”‚  (BCrypt) â”‚            â”‚                     â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚                     â”‚  4. Check Active       â”‚                     â”‚
     â”‚                     â”‚     Consent            â”‚                     â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚                     â”‚  5. Log Resolution     â”‚                     â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                     â”‚    (Tamper-Proof)      â”‚                     â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚  6. Address Details â”‚                        â”‚                     â”‚
     â”‚     (lat, lon,      â”‚                        â”‚                     â”‚
     â”‚      address, score)â”‚                        â”‚                     â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚  7. Fulfill Service â”‚                        â”‚                     â”‚
     â”‚     (Delivery, etc) â”‚                        â”‚                     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚  8. POST /feedback  â”‚                        â”‚                     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚                     â”‚
     â”‚  (fulfillment       â”‚                        â”‚                     â”‚
     â”‚   status)           â”‚                        â”‚                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚                     â”‚  9. Update Confidence  â”‚                     â”‚
     â”‚                     â”‚     Score              â”‚                     â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚                     â”‚  10. Log Score Update  â”‚                     â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚  11. Feedback       â”‚                        â”‚                     â”‚
     â”‚      Recorded       â”‚                        â”‚                     â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
```

### Flow 3: AAVA Physical Verification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AAVA   â”‚         â”‚   DigiPin    â”‚         â”‚   MySQL     â”‚         â”‚ ImmuDB   â”‚
â”‚  Agent  â”‚         â”‚  Application â”‚         â”‚  Database   â”‚         â”‚ Database â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚  1. User flags      â”‚                        â”‚                     â”‚
     â”‚     address for     â”‚                        â”‚                     â”‚
     â”‚     verification    â”‚                        â”‚                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚  2. POST /flag-for- â”‚                        â”‚                     â”‚
     â”‚     aava            â”‚                        â”‚                     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚                     â”‚
     â”‚  (JWT + reason)     â”‚                        â”‚                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚                     â”‚  3. Mark for AAVA      â”‚                     â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚  4. Flagged (200)   â”‚                        â”‚                     â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚  5. AAVA Agent      â”‚                        â”‚                     â”‚
     â”‚     Assigned        â”‚                        â”‚                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚  6. Physical Visit  â”‚                        â”‚                     â”‚
     â”‚     & Verification  â”‚                        â”‚                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚  7. POST /aava-     â”‚                        â”‚                     â”‚
     â”‚     verify          â”‚                        â”‚                     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚                     â”‚
     â”‚  (verification data)â”‚                        â”‚                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚                     â”‚  8. Process            â”‚                     â”‚
     â”‚                     â”‚     Verification       â”‚                     â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚                     â”‚
     â”‚                     â”‚           â”‚            â”‚                     â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚                     â”‚  9. Update Address     â”‚                     â”‚
     â”‚                     â”‚     (AAVA verified,    â”‚                     â”‚
     â”‚                     â”‚      confidence++,     â”‚                     â”‚
     â”‚                     â”‚      verified coords)  â”‚                     â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚                     â”‚  10. Log AAVA          â”‚                     â”‚
     â”‚                     â”‚      Verification      â”‚                     â”‚
     â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                     â”‚                        â”‚                     â”‚
     â”‚  11. Verification   â”‚                        â”‚                     â”‚
     â”‚      Complete       â”‚                        â”‚                     â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚                     â”‚
     â”‚                     â”‚                        â”‚                     â”‚
```

---

## ğŸ’¾ Database Schema

### MySQL Database (Transactional Data)

```sql
-- Users Table
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          users                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id                  BIGINT PRIMARY KEY AUTO_INCREMENT        â”‚
â”‚ user_name           VARCHAR(50) UNIQUE NOT NULL              â”‚
â”‚ phone_number        VARCHAR(15) UNIQUE NOT NULL              â”‚
â”‚ email_id            VARCHAR(100) UNIQUE                      â”‚
â”‚ password            VARCHAR(255) NOT NULL                    â”‚
â”‚ aadhaar_number      VARCHAR(12) UNIQUE                       â”‚
â”‚ is_aadhaar_verified BOOLEAN DEFAULT FALSE                    â”‚
â”‚ created_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP      â”‚
â”‚ updated_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

-- Digital Addresses Table
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    digital_addresses                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id                          BIGINT PRIMARY KEY AUTO_INCREMENTâ”‚
â”‚ user_id                     BIGINT NOT NULL (FK â†’ users)     â”‚
â”‚ digital_address             VARCHAR(100) UNIQUE NOT NULL     â”‚
â”‚ generated_digipin           VARCHAR(20) NOT NULL             â”‚
â”‚ suffix                      VARCHAR(50)                      â”‚
â”‚ latitude                    DOUBLE NOT NULL                  â”‚
â”‚ longitude                   DOUBLE NOT NULL                  â”‚
â”‚ address                     TEXT                             â”‚
â”‚ pin_code                    VARCHAR(10)                      â”‚
â”‚ active_consent_id           BIGINT (FK â†’ consents)           â”‚
â”‚ has_active_consent          BOOLEAN DEFAULT FALSE            â”‚
â”‚ confidence_score            DOUBLE DEFAULT 50.0              â”‚
â”‚ total_ratings               INT DEFAULT 0                    â”‚
â”‚ average_rating              DOUBLE DEFAULT 0.0               â”‚
â”‚ total_fulfillments          INT DEFAULT 0                    â”‚
â”‚ requires_aava_verification  BOOLEAN DEFAULT FALSE            â”‚
â”‚ is_aava_verified            BOOLEAN DEFAULT FALSE            â”‚
â”‚ verification_type           ENUM('SELF','AAVA') DEFAULT 'SELF'â”‚
â”‚ aava_agent_id               VARCHAR(50)                      â”‚
â”‚ aava_verified_at            TIMESTAMP                        â”‚
â”‚ aava_verification_notes     TEXT                             â”‚
â”‚ verified_latitude           DOUBLE                           â”‚
â”‚ verified_longitude          DOUBLE                           â”‚
â”‚ created_at                  TIMESTAMP DEFAULT CURRENT_TIMESTAMPâ”‚
â”‚ updated_at                  TIMESTAMP DEFAULT CURRENT_TIMESTAMPâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

-- Consents Table
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         consents                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id                    BIGINT PRIMARY KEY AUTO_INCREMENT      â”‚
â”‚ user_id               BIGINT NOT NULL (FK â†’ users)           â”‚
â”‚ digital_address_id    BIGINT NOT NULL (FK â†’ digital_addresses)â”‚
â”‚ upi_pin_hash          VARCHAR(255) NOT NULL                  â”‚
â”‚ consent_token         VARCHAR(10) UNIQUE NOT NULL            â”‚
â”‚ consent_type          ENUM('PERMANENT','TEMPORARY')          â”‚
â”‚ created_at            TIMESTAMP DEFAULT CURRENT_TIMESTAMP    â”‚
â”‚ expires_at            TIMESTAMP NULL                         â”‚
â”‚ is_active             BOOLEAN DEFAULT TRUE                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

-- Aadhaar Mock Data Table (Test/Demo)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    aadhaar_mock_data                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id                  BIGINT PRIMARY KEY AUTO_INCREMENT        â”‚
â”‚ aadhaar_number      VARCHAR(12) UNIQUE NOT NULL              â”‚
â”‚ full_name           VARCHAR(100) NOT NULL                    â”‚
â”‚ date_of_birth       DATE NOT NULL                            â”‚
â”‚ gender              VARCHAR(10)                              â”‚
â”‚ address             TEXT                                     â”‚
â”‚ state               VARCHAR(50)                              â”‚
â”‚ pincode             VARCHAR(10)                              â”‚
â”‚ mobile_number       VARCHAR(15)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

-- User Addresses Table (AIU Storage)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      user_addresses                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id                  BIGINT PRIMARY KEY AUTO_INCREMENT        â”‚
â”‚ name                VARCHAR(100)                             â”‚
â”‚ phone_number        VARCHAR(15)                              â”‚
â”‚ digital_address     VARCHAR(100)                             â”‚
â”‚ upi_pin             VARCHAR(6)                               â”‚
â”‚ created_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ImmuDB Database (Tamper-Proof Audit Trail)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ImmuDB Key-Value Store                    â”‚
â”‚                  (Cryptographically Verified)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Key Format: <event_type>:<identifier>:<timestamp>          â”‚
â”‚                                                              â”‚
â”‚  Event Types:                                                â”‚
â”‚  â”œâ”€â”€ address:create:<digital_address>:<timestamp>           â”‚
â”‚  â”œâ”€â”€ address:resolve:<digital_address>:<timestamp>          â”‚
â”‚  â”œâ”€â”€ aava:verify:<digital_address>:<timestamp>              â”‚
â”‚  â””â”€â”€ confidence:update:<digital_address>:<timestamp>        â”‚
â”‚                                                              â”‚
â”‚  Value Format: JSON with event details                      â”‚
â”‚  {                                                           â”‚
â”‚    "eventType": "ADDRESS_CREATED",                          â”‚
â”‚    "digitalAddress": "user@home",                           â”‚
â”‚    "userId": 123,                                            â”‚
â”‚    "latitude": 28.6139,                                      â”‚
â”‚    "longitude": 77.2090,                                     â”‚
â”‚    "timestamp": "2025-12-02T10:30:00Z",                     â”‚
â”‚    "_txId": 42,              // ImmuDB transaction ID       â”‚
â”‚    "_verified": true          // Cryptographic verification â”‚
â”‚  }                                                           â”‚
â”‚                                                              â”‚
â”‚  Features:                                                   â”‚
â”‚  âœ“ Immutable (cannot be modified)                           â”‚
â”‚  âœ“ Cryptographically signed                                 â”‚
â”‚  âœ“ Tamper detection                                         â”‚
â”‚  âœ“ Complete audit history                                   â”‚
â”‚  âœ“ Transaction IDs for verification                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ Security Architecture

### 1. Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚                                          â”‚  Server  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                                                     â”‚
     â”‚  1. POST /api/auth/login                            â”‚
     â”‚    { emailOrPhone, password }                       â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                                                     â”‚
     â”‚                              2. Validate credentialsâ”‚
     â”‚                                  (BCrypt password)  â”‚
     â”‚                                                     â”‚
     â”‚                               3. Generate JWT Token â”‚
     â”‚                                  - Header: alg=HS256â”‚
     â”‚                                  - Payload: userId  â”‚
     â”‚                                  - Signature: HMAC  â”‚
     â”‚                                                     â”‚
     â”‚  4. JWT Token                                       â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚    { "token": "eyJhbGc..." }                        â”‚
     â”‚                                                     â”‚
     â”‚  5. Subsequent API calls                            â”‚
     â”‚     Authorization: Bearer <token>                   â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                                                     â”‚
     â”‚                           6. JwtAuthenticationFilterâ”‚
     â”‚                                  validates token    â”‚
     â”‚                                                     â”‚
     â”‚                             7. SecurityContextHolderâ”‚
     â”‚                                  sets authenticationâ”‚
     â”‚                                                     â”‚
     â”‚  8. Response                                        â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                                     
```

### 2. Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SECURITY LAYERS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Layer 1: Transport Security                                â”‚
â”‚  â””â”€ HTTPS/TLS (Production)                                  â”‚
â”‚                                                             â”‚
â”‚  Layer 2: CORS Configuration                                â”‚
â”‚  â”œâ”€ Allowed Origins: Configured domains                     â”‚
â”‚  â”œâ”€ Allowed Methods: GET, POST, PUT, DELETE                 â”‚
â”‚  â””â”€ Exposed Headers: Authorization                          â”‚
â”‚                                                             â”‚
â”‚  Layer 3: JWT Authentication                                â”‚
â”‚  â”œâ”€ Algorithm: HMAC-SHA256                                  â”‚
â”‚  â”œâ”€ Token Expiration: 343 hours (~14 days)                  â”‚
â”‚  â”œâ”€ Secret Key: 512-bit (stored securely)                   â”‚
â”‚  â””â”€ Claims: userId, username, email, authorities            â”‚
â”‚                                                             â”‚
â”‚  Layer 4: Spring Security                                   â”‚
â”‚  â”œâ”€ Security Filter Chain                                   â”‚
â”‚  â”œâ”€ JWT Authentication Filter (before UsernamePassword)     â”‚
â”‚  â”œâ”€ Authentication Manager                                  â”‚
â”‚  â””â”€ UserDetailsService (custom implementation)              â”‚
â”‚                                                             â”‚
â”‚  Layer 5: Password Security                                 â”‚
â”‚  â”œâ”€ BCrypt Hashing (strength: 10)                           â”‚
â”‚  â”œâ”€ Salt: Random per password                               â”‚
â”‚  â””â”€ No plain-text storage                                   â”‚
â”‚                                                             â”‚
â”‚  Layer 6: Consent Security                                  â”‚
â”‚  â”œâ”€ 6-digit UPI PIN                                         â”‚
â”‚  â”œâ”€ BCrypt hashed (never stored plain)                      â”‚
â”‚  â”œâ”€ Token-based sharing                                     â”‚
â”‚  â””â”€ Time-based expiry                                       â”‚
â”‚                                                             â”‚
â”‚  Layer 7: Data Privacy                                      â”‚
â”‚  â”œâ”€ Aadhaar masking (only last 4 digits visible)            â”‚
â”‚  â”œâ”€ PII protection                                          â”‚
â”‚  â””â”€ Ownership validation (users can only access their data) â”‚
â”‚                                                             â”‚
â”‚  Layer 8: Audit Security (ImmuDB)                           â”‚
â”‚  â”œâ”€ Immutable audit logs                                    â”‚
â”‚  â”œâ”€ Cryptographic verification                              â”‚
â”‚  â”œâ”€ Tamper detection                                        â”‚
â”‚  â””â”€ Complete traceability                                   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Notes:
* Requires Aadhaar verification
** Ownership validation required (own resources only)
```

---

## ğŸŒ API Architecture

### API Design Principles

1. **RESTful**: Resource-based URLs, HTTP methods, status codes
2. **Stateless**: No server-side session, JWT for authentication
3. **Versioned**: `/api/v1/...` (currently implicit v1)
4. **JSON**: Request/response format
5. **Error Handling**: Consistent error response structure
6. **Validation**: Jakarta Validation annotations
7. **Documentation**: Self-documenting with clear naming

### API Response Patterns

```json
// Success Response (200/201)
{
  "message": "Operation successful",
  "data": { /* response payload */ },
  "timestamp": "2025-12-02T10:30:00Z"
}

// Error Response (4xx/5xx)
{
  "error": "Error message",
  "status": 400,
  "timestamp": "2025-12-02T10:30:00Z"
}

// Audit Response (with ImmuDB verification)
{
  "data": { /* response payload */ },
  "tamperProof": true,
  "_txId": 42,
  "_verified": true
}
```

### DigiPin Algorithm Details

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DigiPin Grid-Based Algorithm                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Grid System (4x4):                                         â”‚
â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                          â”‚
â”‚  â”‚ F â”‚ C â”‚ 9 â”‚ 8 â”‚  Row 0 (North)                          â”‚
â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                                          â”‚
â”‚  â”‚ J â”‚ 3 â”‚ 2 â”‚ 7 â”‚  Row 1                                  â”‚
â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                                          â”‚
â”‚  â”‚ K â”‚ 4 â”‚ 5 â”‚ 6 â”‚  Row 2                                  â”‚
â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤                                          â”‚
â”‚  â”‚ L â”‚ M â”‚ P â”‚ T â”‚  Row 3 (South)                          â”‚
â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                          â”‚
â”‚   Col0 Col1 Col2 Col3                                       â”‚
â”‚   West         East                                         â”‚
â”‚                                                              â”‚
â”‚  Coverage:                                                   â”‚
â”‚  â””â”€ India: 2.5Â°N to 38.5Â°N, 63.5Â°E to 99.5Â°E               â”‚
â”‚                                                              â”‚
â”‚  Algorithm:                                                  â”‚
â”‚  1. Start with full India bounding box                      â”‚
â”‚  2. Divide into 4x4 grid (16 cells)                         â”‚
â”‚  3. Identify cell containing coordinates                     â”‚
â”‚  4. Append grid character to DigiPin                        â”‚
â”‚  5. Repeat for 10 levels (recursive subdivision)            â”‚
â”‚  6. Add hyphens at positions 3 and 6                        â”‚
â”‚                                                              â”‚
â”‚  Output Format: XXX-XXX-XXXX                                â”‚
â”‚  Example: FC9-823-7654                                       â”‚
â”‚                                                              â”‚
â”‚  Precision:                                                  â”‚
â”‚  â””â”€ 10 characters â‰ˆ ~10 meter accuracy                      â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Confidence Score System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Confidence Score Algorithm                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Initial Score: 50.0 (Self-verified)                        â”‚
â”‚                                                              â”‚
â”‚  Score Modifiers:                                            â”‚
â”‚  â”œâ”€ AAVA Verification: +30.0 â†’ 80.0 (Trusted)               â”‚
â”‚  â”œâ”€ Successful Delivery: +2.0 per fulfillment               â”‚
â”‚  â”œâ”€ Failed Delivery: -5.0 per failure                       â”‚
â”‚  â””â”€ User Ratings: Average rating contribution                â”‚
â”‚                                                              â”‚
â”‚  Score Range: 0.0 - 100.0                                   â”‚
â”‚                                                              â”‚
â”‚  Trust Levels:                                               â”‚
â”‚  â”œâ”€ 0-49:   Low Trust (Deliveries may be rejected)          â”‚
â”‚  â”œâ”€ 50-69:  Medium Trust (Basic services)                   â”‚
â”‚  â”œâ”€ 70-79:  High Trust (Most services)                      â”‚
â”‚  â””â”€ 80-100: Very High Trust (All services, govt verified)   â”‚
â”‚                                                              â”‚
â”‚  Use Case Approvals:                                         â”‚
â”‚  â”œâ”€ Government Welfare: AAVA verified only (score â‰¥ 80)     â”‚
â”‚  â”œâ”€ Legal Notices: AAVA verified only (score â‰¥ 80)          â”‚
â”‚  â”œâ”€ Emergency Services: score â‰¥ 80 OR AAVA verified         â”‚
â”‚  â”œâ”€ E-Commerce: score â‰¥ 50                                  â”‚
â”‚  â””â”€ Food Delivery: score â‰¥ 50                               â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Technology Stack Details

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   TECHNOLOGY STACK                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Backend Framework:                                          â”‚
â”‚  â”œâ”€ Spring Boot: 3.5.8                                      â”‚
â”‚  â”œâ”€ Spring Data JPA: Data access & ORM                      â”‚
â”‚  â”œâ”€ Spring Security: Authentication & authorization          â”‚
â”‚  â”œâ”€ Spring Web: RESTful web services                        â”‚
â”‚  â””â”€ Hibernate: ORM implementation                           â”‚
â”‚                                                              â”‚
â”‚  Databases:                                                  â”‚
â”‚  â”œâ”€ MySQL 8.0: Primary transactional database               â”‚
â”‚  â”‚  â””â”€ Connector: mysql-connector-j                         â”‚
â”‚  â””â”€ ImmuDB (latest): Tamper-proof audit trail               â”‚
â”‚     â”œâ”€ gRPC API (port 3322)                                 â”‚
â”‚     â””â”€ HTTP API (port 9497)                                 â”‚
â”‚                                                              â”‚
â”‚  Security Libraries:                                         â”‚
â”‚  â”œâ”€ JWT (JJWT): 0.12.3                                      â”‚
â”‚  â”‚  â”œâ”€ jjwt-api: API definitions                            â”‚
â”‚  â”‚  â”œâ”€ jjwt-impl: Implementation                            â”‚
â”‚  â”‚  â””â”€ jjwt-jackson: JSON processing                        â”‚
â”‚  â”œâ”€ BCrypt: Password & PIN hashing                          â”‚
â”‚  â””â”€ Spring Security Crypto: Encryption utilities            â”‚
â”‚                                                              â”‚
â”‚  Validation:                                                 â”‚
â”‚  â””â”€ Jakarta Validation: Bean validation                     â”‚
â”‚                                                              â”‚
â”‚                                                              â”‚
â”‚  Utility Libraries:                                          â”‚
â”‚  â”œâ”€ Lombok: Code generation (@Data, @Builder, etc.)         â”‚
â”‚  â”œâ”€ Jackson: JSON serialization/deserialization             â”‚
â”‚  â”‚  â”œâ”€ jackson-databind                                     â”‚
â”‚  â”‚  â””â”€ jackson-datatype-jsr310 (Java 8 Date/Time)          â”‚
â”‚  â””â”€ SLF4J/Logback: Logging framework                        â”‚
â”‚                                                              â”‚
â”‚  Build & Deployment:                                         â”‚
â”‚  â”œâ”€ Maven: 3.6+ (Build tool)                                â”‚
â”‚  â”œâ”€ Java: 21 (LTS)                                          â”‚
â”‚  â””â”€ Docker & Docker Compose: Container orchestration        â”‚
â”‚                                                              â”‚
â”‚  Testing:                                                    â”‚
â”‚  â””â”€ Spring Boot Test: Testing framework                     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Performance & Scalability

### Performance Optimizations

1. **Database Indexing**
   - Primary keys on all tables
   - Unique constraints on digital_address, consent_token
   - Foreign key indexes for joins

2. **Connection Pooling**
   - HikariCP (Spring Boot default)
   - Optimized pool size

3. **Caching Strategy**
   - JWT token validation (in-memory)
   - User details caching

4. **Stateless Design**
   - No server-side sessions
   - Horizontal scaling support

### Scalability Considerations

1. **Horizontal Scaling**: Multiple application instances behind load balancer
2. **Database Replication**: MySQL master-slave for read scaling
3. **ImmuDB Clustering**: Distributed audit trail (future enhancement)
4. **CDN Integration**: Static asset delivery (future enhancement)
5. **API Gateway**: Rate limiting, request routing (future enhancement)

---

## ğŸ” Monitoring & Observability

### Logging Strategy

```
Application Logs:
â”œâ”€ Level: DEBUG (com.hackathon.resolutionconsent.digipin)
â”œâ”€ Level: INFO (org.springframework.web)
â”œâ”€ Format: [timestamp] [level] [class] - message
â””â”€ Destination: Console (production â†’ file/ELK)

Audit Logs (ImmuDB):
â”œâ”€ All address operations
â”œâ”€ All consent resolutions
â”œâ”€ All AAVA verifications
â””â”€ All confidence score updates

Security Logs:
â”œâ”€ Failed login attempts
â”œâ”€ Invalid token attempts
â””â”€ Unauthorized access attempts
```

### Health Checks

```
Application Health: /actuator/health (Spring Boot Actuator)
MySQL Health: mysqladmin ping
ImmuDB Health: curl http://localhost:9497/api/v1/health
```

---

## ğŸ¯ Use Case Flows

### Use Case 1: E-Commerce Delivery

```
1. Customer creates digital address (Tribhuvan@office)
2. Customer generates PERMANENT consent with 6-digit PIN
3. Customer shares: Tribhuvan@office + UPI PIN with merchant
4. Merchant (AIU) resolves address using /api/aiu/resolve-with-consent
5. Merchant receives lat/lon + full address
6. Delivery agent navigates to location
7. Merchant submits feedback: SUCCESSFUL
8. Confidence score increases
```

### Use Case 2: Government Welfare Scheme

```
1. Citizen creates digital address (Priya@home)
2. Citizen flags address for AAVA verification
3. AAVA agent visits location physically
4. Agent verifies identity, location accuracy
5. Agent submits verification via /api/aava/aava-verify
6. Address marked as AAVA_VERIFIED, score â†’ 80+
7. Government system approves address for welfare benefits
8. All operations logged to ImmuDB (tamper-proof)
```

### Use Case 3: Emergency Services

```
1. User in distress needs ambulance
2. User shares digital address with emergency services
3. Emergency service (approved AIU) resolves address instantly
4. Coordinates shared with ambulance driver
5. Driver reaches location using GPS
6. No AAVA verification required (emergency exception)
7. Incident logged for audit trail
```

---

## ğŸ” Compliance & Audit

### Data Protection

- **PII Protection**: Aadhaar numbers masked
- **Encryption**: Passwords/PINs hashed (BCrypt)
- **Access Control**: Role-based authorization
- **Data Retention**: Audit logs retained indefinitely (ImmuDB)

### Audit Trail Requirements

- âœ… **Complete History**: All operations logged
- âœ… **Tamper-Proof**: Cryptographic verification
- âœ… **Time-Stamped**: All events with timestamps
- âœ… **Traceable**: User IDs, addresses tracked
- âœ… **Verifiable**: ImmuDB transaction IDs

---

## ğŸ“š References

### Technology Documentation
- [Spring Boot Documentation](https://spring.io/projects/spring-boot)
- [Spring Security Reference](https://docs.spring.io/spring-security/reference/index.html)
- [ImmuDB Documentation](https://docs.immudb.io/)
- [MySQL 8.0 Reference Manual](https://dev.mysql.com/doc/refman/8.0/en/)
- [JWT.io](https://jwt.io/)

### Architecture Patterns
- MVC (Model-View-Controller)
- Repository Pattern
- Service Layer Pattern
- DTO (Data Transfer Object) Pattern

---

**Document Version**: 1.0  
**Last Updated**: December 2, 2025  
**Maintained By**: Tribhuvan-Web

---
